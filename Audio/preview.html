<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Brandy – Drum Preview</title>
  <style>
    body {
      font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      margin: 16px;
      background: #0b0b0f;
      color: #f2f2f6;
    }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .card {
      background: #151522;
      border: 1px solid #2a2a3d;
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }
    .controls input {
      width: 340px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #2a2a3d;
      background: #0f0f18;
      color: #f2f2f6;
    }
    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid #2a2a3d;
      background: #1c1c2b;
      color: #f2f2f6;
      cursor: pointer;
    }
    button:hover { background: #242438; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }
    .pad {
      height: 140px;
      border-radius: 18px;
      border: 2px solid #2a2a3d;
      background: #101021;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      user-select: none;
    }
    .pad .label {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.3px;
    }
    .pad .sub {
      position: absolute;
      bottom: 10px;
      left: 12px;
      font-size: 14px;
      opacity: 0.8;
    }
    .lit {
      filter: brightness(1.7);
      border-color: #ffffff;
      box-shadow: 0 0 30px rgba(255,255,255,0.25);
      background: #1d1d35;
    }
    .meta {
      margin-top: 10px;
      opacity: 0.85;
      font-size: 14px;
      line-height: 1.4;
    }
    #player {
      width: 100%;
      max-width: 720px;
      aspect-ratio: 16 / 9;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid #2a2a3d;
    }
    .slider {
      display: grid;
      grid-template-columns: 120px 1fr 80px;
      gap: 10px;
      align-items: center;
      margin-top: 10px;
    }
    .slider input[type="range"] { width: 100%; }
    code {
      background: #0f0f18;
      border: 1px solid #2a2a3d;
      padding: 2px 6px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h2 style="margin: 0 0 6px 0;">Drum Cue Preview – Brandy</h2>
  <div class="meta" style="margin: 0 0 12px 0;">
    Source JSON: <code>BrandyDrumCover.drums2.json</code> • events: <code>249</code> • first t_ms: <code>894</code> • last t_ms: <code>185911</code>
  </div>

  <div class="row">
    <div class="card controls" style="flex: 1; min-width: 360px;">
      <div class="row" style="margin-bottom: 10px;">
        <input id="ytInput" placeholder="Paste YouTube URL or ID (e.g. dQw4w9WgXcQ)" />
        <button id="loadBtn">Load Video</button>
      </div>

      <div class="row" style="margin-bottom: 8px;">
        <button id="startBtn" disabled>Start</button>
        <button id="pauseBtn" disabled>Pause</button>
        <button id="resetBtn" disabled>Reset</button>
      </div>

      <div class="slider">
        <div>Offset (ms)</div>
        <input id="offset" type="range" min="-3000" max="3000" value="0" />
        <div id="offsetVal">0</div>
      </div>

      <div class="slider">
        <div>Flash (ms)</div>
        <input id="flash" type="range" min="40" max="400" value="120" />
        <div id="flashVal">120</div>
      </div>

      <div class="meta" id="status">
        Loaded <code>BrandyDrumCover.drums2.json</code> (first event at 894ms). Load a video, then press <code>Start</code>.
      </div>
    </div>

    <div class="card" style="flex: 1; min-width: 360px;">
      <div id="player"></div>
      <div class="meta">
        Tip: If cues feel early/late, adjust <b>Offset</b> until kick+snare match what you hear.
      </div>
    </div>
  </div>

  <div class="grid">
    <div class="pad" id="pad1"><div class="label">KICK</div><div class="sub">a • id 1</div></div>
    <div class="pad" id="pad3"><div class="label">SNARE</div><div class="sub">s • id 3</div></div>
    <div class="pad" id="pad5"><div class="label">HI-HAT</div><div class="sub">k • id 5</div></div>
    <div class="pad" id="pad6"><div class="label">CRASH</div><div class="sub">l • id 6</div></div>
  </div>

  <script>
    const EVENTS = [{"t_ms": 894, "drum": 6}, {"t_ms": 1881, "drum": 3}, {"t_ms": 2647, "drum": 3}, {"t_ms": 2902, "drum": 3}, {"t_ms": 3135, "drum": 3}, {"t_ms": 3889, "drum": 3}, {"t_ms": 4923, "drum": 3}, {"t_ms": 4923, "drum": 5}, {"t_ms": 5840, "drum": 3}, {"t_ms": 6861, "drum": 3}, {"t_ms": 7094, "drum": 3}, {"t_ms": 7558, "drum": 3}, {"t_ms": 7802, "drum": 3}, {"t_ms": 8290, "drum": 3}, {"t_ms": 8580, "drum": 3}, {"t_ms": 8800, "drum": 3}, {"t_ms": 9056, "drum": 3}, {"t_ms": 13247, "drum": 3}, {"t_ms": 15848, "drum": 3}, {"t_ms": 18042, "drum": 3}, {"t_ms": 18471, "drum": 3}, {"t_ms": 18994, "drum": 3}, {"t_ms": 18994, "drum": 6}, {"t_ms": 19493, "drum": 3}, {"t_ms": 19725, "drum": 3}, {"t_ms": 20248, "drum": 3}, {"t_ms": 20480, "drum": 3}, {"t_ms": 20968, "drum": 3}, {"t_ms": 21177, "drum": 3}, {"t_ms": 21386, "drum": 3}, {"t_ms": 21920, "drum": 5}, {"t_ms": 22094, "drum": 3}, {"t_ms": 22372, "drum": 3}, {"t_ms": 23324, "drum": 3}, {"t_ms": 23533, "drum": 3}, {"t_ms": 24044, "drum": 3}, {"t_ms": 24276, "drum": 3}, {"t_ms": 25263, "drum": 3}, {"t_ms": 25983, "drum": 3}, {"t_ms": 26250, "drum": 3}, {"t_ms": 26250, "drum": 6}, {"t_ms": 27133, "drum": 3}, {"t_ms": 27899, "drum": 1}, {"t_ms": 27899, "drum": 3}, {"t_ms": 28119, "drum": 5}, {"t_ms": 28526, "drum": 6}, {"t_ms": 28851, "drum": 3}, {"t_ms": 29106, "drum": 3}, {"t_ms": 29106, "drum": 5}, {"t_ms": 29315, "drum": 3}, {"t_ms": 29780, "drum": 3}, {"t_ms": 30232, "drum": 3}, {"t_ms": 30523, "drum": 5}, {"t_ms": 31010, "drum": 5}, {"t_ms": 31498, "drum": 3}, {"t_ms": 31695, "drum": 3}, {"t_ms": 31974, "drum": 3}, {"t_ms": 32926, "drum": 3}, {"t_ms": 33692, "drum": 3}, {"t_ms": 33913, "drum": 3}, {"t_ms": 35619, "drum": 1}, {"t_ms": 35619, "drum": 3}, {"t_ms": 36072, "drum": 3}, {"t_ms": 36328, "drum": 3}, {"t_ms": 36757, "drum": 3}, {"t_ms": 37489, "drum": 3}, {"t_ms": 37721, "drum": 3}, {"t_ms": 39439, "drum": 3}, {"t_ms": 39671, "drum": 5}, {"t_ms": 39903, "drum": 3}, {"t_ms": 40635, "drum": 3}, {"t_ms": 41123, "drum": 3}, {"t_ms": 42040, "drum": 3}, {"t_ms": 42539, "drum": 3}, {"t_ms": 42539, "drum": 5}, {"t_ms": 42771, "drum": 3}, {"t_ms": 43294, "drum": 3}, {"t_ms": 43514, "drum": 3}, {"t_ms": 44489, "drum": 5}, {"t_ms": 44710, "drum": 3}, {"t_ms": 45198, "drum": 3}, {"t_ms": 45453, "drum": 5}, {"t_ms": 45708, "drum": 3}, {"t_ms": 52152, "drum": 3}, {"t_ms": 55983, "drum": 3}, {"t_ms": 56924, "drum": 3}, {"t_ms": 58839, "drum": 3}, {"t_ms": 60987, "drum": 3}, {"t_ms": 62438, "drum": 3}, {"t_ms": 62891, "drum": 3}, {"t_ms": 63414, "drum": 3}, {"t_ms": 63623, "drum": 3}, {"t_ms": 64134, "drum": 3}, {"t_ms": 64377, "drum": 3}, {"t_ms": 64598, "drum": 3}, {"t_ms": 65051, "drum": 3}, {"t_ms": 65550, "drum": 3}, {"t_ms": 66258, "drum": 3}, {"t_ms": 66525, "drum": 3}, {"t_ms": 66525, "drum": 5}, {"t_ms": 67013, "drum": 3}, {"t_ms": 67512, "drum": 6}, {"t_ms": 68220, "drum": 3}, {"t_ms": 68441, "drum": 3}, {"t_ms": 69184, "drum": 3}, {"t_ms": 69451, "drum": 5}, {"t_ms": 69613, "drum": 3}, {"t_ms": 70171, "drum": 3}, {"t_ms": 70368, "drum": 3}, {"t_ms": 70589, "drum": 3}, {"t_ms": 71123, "drum": 3}, {"t_ms": 71343, "drum": 3}, {"t_ms": 71831, "drum": 3}, {"t_ms": 72063, "drum": 3}, {"t_ms": 72493, "drum": 3}, {"t_ms": 72725, "drum": 3}, {"t_ms": 72992, "drum": 3}, {"t_ms": 73247, "drum": 5}, {"t_ms": 73456, "drum": 3}, {"t_ms": 73979, "drum": 1}, {"t_ms": 74176, "drum": 3}, {"t_ms": 74455, "drum": 3}, {"t_ms": 74710, "drum": 5}, {"t_ms": 75453, "drum": 3}, {"t_ms": 75662, "drum": 5}, {"t_ms": 75848, "drum": 3}, {"t_ms": 76115, "drum": 3}, {"t_ms": 76115, "drum": 6}, {"t_ms": 76603, "drum": 5}, {"t_ms": 76812, "drum": 5}, {"t_ms": 77044, "drum": 3}, {"t_ms": 77415, "drum": 3}, {"t_ms": 77775, "drum": 3}, {"t_ms": 78019, "drum": 3}, {"t_ms": 78983, "drum": 3}, {"t_ms": 79505, "drum": 3}, {"t_ms": 79970, "drum": 3}, {"t_ms": 81688, "drum": 3}, {"t_ms": 81908, "drum": 3}, {"t_ms": 81908, "drum": 5}, {"t_ms": 82373, "drum": 3}, {"t_ms": 83603, "drum": 3}, {"t_ms": 83789, "drum": 3}, {"t_ms": 84753, "drum": 3}, {"t_ms": 85740, "drum": 3}, {"t_ms": 86471, "drum": 3}, {"t_ms": 86715, "drum": 5}, {"t_ms": 87435, "drum": 3}, {"t_ms": 87655, "drum": 6}, {"t_ms": 87922, "drum": 3}, {"t_ms": 88654, "drum": 6}, {"t_ms": 89629, "drum": 5}, {"t_ms": 89861, "drum": 3}, {"t_ms": 90593, "drum": 3}, {"t_ms": 90593, "drum": 5}, {"t_ms": 90802, "drum": 3}, {"t_ms": 91556, "drum": 6}, {"t_ms": 92032, "drum": 5}, {"t_ms": 92253, "drum": 5}, {"t_ms": 92473, "drum": 3}, {"t_ms": 95144, "drum": 3}, {"t_ms": 98220, "drum": 3}, {"t_ms": 99857, "drum": 3}, {"t_ms": 104954, "drum": 3}, {"t_ms": 106127, "drum": 3}, {"t_ms": 107079, "drum": 3}, {"t_ms": 110422, "drum": 3}, {"t_ms": 110678, "drum": 3}, {"t_ms": 110887, "drum": 3}, {"t_ms": 112582, "drum": 3}, {"t_ms": 114254, "drum": 3}, {"t_ms": 114753, "drum": 3}, {"t_ms": 115949, "drum": 6}, {"t_ms": 117354, "drum": 3}, {"t_ms": 118329, "drum": 3}, {"t_ms": 118573, "drum": 3}, {"t_ms": 120036, "drum": 3}, {"t_ms": 120279, "drum": 3}, {"t_ms": 121231, "drum": 3}, {"t_ms": 122416, "drum": 3}, {"t_ms": 123890, "drum": 3}, {"t_ms": 128488, "drum": 3}, {"t_ms": 132307, "drum": 3}, {"t_ms": 136928, "drum": 3}, {"t_ms": 137822, "drum": 3}, {"t_ms": 138797, "drum": 3}, {"t_ms": 139250, "drum": 3}, {"t_ms": 139691, "drum": 3}, {"t_ms": 140492, "drum": 3}, {"t_ms": 140934, "drum": 3}, {"t_ms": 141189, "drum": 3}, {"t_ms": 141386, "drum": 3}, {"t_ms": 141642, "drum": 3}, {"t_ms": 141920, "drum": 6}, {"t_ms": 142373, "drum": 3}, {"t_ms": 142373, "drum": 6}, {"t_ms": 142872, "drum": 6}, {"t_ms": 143105, "drum": 1}, {"t_ms": 143325, "drum": 3}, {"t_ms": 143325, "drum": 6}, {"t_ms": 144080, "drum": 3}, {"t_ms": 144277, "drum": 3}, {"t_ms": 144533, "drum": 3}, {"t_ms": 145264, "drum": 3}, {"t_ms": 145264, "drum": 6}, {"t_ms": 146181, "drum": 3}, {"t_ms": 146971, "drum": 3}, {"t_ms": 147156, "drum": 3}, {"t_ms": 147400, "drum": 6}, {"t_ms": 148155, "drum": 3}, {"t_ms": 148155, "drum": 6}, {"t_ms": 148643, "drum": 5}, {"t_ms": 148898, "drum": 3}, {"t_ms": 149130, "drum": 5}, {"t_ms": 150071, "drum": 6}, {"t_ms": 150802, "drum": 3}, {"t_ms": 150988, "drum": 3}, {"t_ms": 151963, "drum": 3}, {"t_ms": 151963, "drum": 6}, {"t_ms": 152416, "drum": 6}, {"t_ms": 152938, "drum": 3}, {"t_ms": 153391, "drum": 3}, {"t_ms": 153902, "drum": 3}, {"t_ms": 154610, "drum": 3}, {"t_ms": 158708, "drum": 3}, {"t_ms": 159660, "drum": 3}, {"t_ms": 161564, "drum": 3}, {"t_ms": 172803, "drum": 3}, {"t_ms": 173987, "drum": 3}, {"t_ms": 173987, "drum": 6}, {"t_ms": 174904, "drum": 3}, {"t_ms": 176599, "drum": 3}, {"t_ms": 176797, "drum": 3}, {"t_ms": 178202, "drum": 3}, {"t_ms": 179688, "drum": 3}, {"t_ms": 179931, "drum": 3}, {"t_ms": 180628, "drum": 3}, {"t_ms": 181104, "drum": 6}, {"t_ms": 181545, "drum": 3}, {"t_ms": 182079, "drum": 5}, {"t_ms": 182323, "drum": 3}, {"t_ms": 182555, "drum": 3}, {"t_ms": 182555, "drum": 6}, {"t_ms": 182787, "drum": 3}, {"t_ms": 184285, "drum": 3}, {"t_ms": 184947, "drum": 3}, {"t_ms": 185168, "drum": 3}, {"t_ms": 185168, "drum": 6}, {"t_ms": 185911, "drum": 3}];
    const JSON_NAME = "BrandyDrumCover.drums2.json";
    const FIRST_T_MS = 894;

    const PAD = {
      1: document.getElementById("pad1"),
      3: document.getElementById("pad3"),
      5: document.getElementById("pad5"),
      6: document.getElementById("pad6"),
    };

    const statusEl = document.getElementById("status");
    const loadBtn = document.getElementById("loadBtn");
    const startBtn = document.getElementById("startBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const resetBtn = document.getElementById("resetBtn");

    const offsetSlider = document.getElementById("offset");
    const flashSlider = document.getElementById("flash");
    const offsetVal = document.getElementById("offsetVal");
    const flashVal = document.getElementById("flashVal");

    offsetVal.textContent = offsetSlider.value;
    flashVal.textContent = flashSlider.value;

    offsetSlider.addEventListener("input", () => offsetVal.textContent = offsetSlider.value);
    flashSlider.addEventListener("input", () => flashVal.textContent = flashSlider.value);

    function parseYouTubeId(input) {
      const s = input.trim();
      if (!s) return null;
      if (/^[a-zA-Z0-9_-]{11}$/.test(s)) return s;

      const vMatch = s.match(/[?&]v=([^&]+)/);
      if (vMatch) return vMatch[1];

      const shortMatch = s.match(/youtu\.be\/([^?&]+)/);
      if (shortMatch) return shortMatch[1];

      const embedMatch = s.match(/\/embed\/([^?&]+)/);
      if (embedMatch) return embedMatch[1];

      return null;
    }

    function flashPad(drumId, flashMs) {
      const el = PAD[drumId];
      if (!el) return;
      el.classList.add("lit");
      setTimeout(() => el.classList.remove("lit"), flashMs);
    }

    let player = null;
    let tickHandle = null;
    let eventIdx = 0;
    let playing = false;

    function resetCueState() {
      eventIdx = 0;
    }

    function tick() {
      if (!player || !playing) return;

      const tSec = player.getCurrentTime ? player.getCurrentTime() : 0;
      const tMs = Math.floor(tSec * 1000);
      const offsetMs = parseInt(offsetSlider.value, 10);
      const flashMs = parseInt(flashSlider.value, 10);

      const chartMs = tMs + offsetMs;

      while (eventIdx < EVENTS.length && EVENTS[eventIdx].t_ms <= chartMs) {
        flashPad(EVENTS[eventIdx].drum, flashMs);
        eventIdx++;
      }

      const next = (eventIdx < EVENTS.length) ? EVENTS[eventIdx].t_ms : null;
      if (next !== null) {
        statusEl.textContent =
          `JSON=${JSON_NAME} (first=${FIRST_T_MS}ms) | video=${tMs}ms, chart=${chartMs}ms | next in ${Math.max(0, next - chartMs)}ms | fired ${eventIdx}/${EVENTS.length}`;
      } else {
        statusEl.textContent = `Done: fired all ${EVENTS.length} events. Hit Reset to replay.`;
      }
    }

    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);

    window.onYouTubeIframeAPIReady = function() {
      statusEl.textContent = `YouTube API ready. Loaded ${JSON_NAME} (first=${FIRST_T_MS}ms). Load a video.`;
    }

    function createPlayer(videoId) {
      if (player && player.destroy) player.destroy();

      player = new YT.Player('player', {
        height: '100%',
        width: '100%',
        videoId: videoId,
        playerVars: { modestbranding: 1, rel: 0 },
        events: {
          'onReady': () => {
            startBtn.disabled = false;
            pauseBtn.disabled = false;
            resetBtn.disabled = false;
            statusEl.textContent = `Video loaded. Press Start. (JSON first event = ${FIRST_T_MS}ms)`;
          },
          'onStateChange': (e) => {
            if (e.data === 0) playing = false;
          }
        }
      });
    }

    loadBtn.addEventListener("click", () => {
      const input = document.getElementById("ytInput").value;
      const vid = parseYouTubeId(input);
      if (!vid) {
        statusEl.textContent = "Couldn’t parse YouTube ID. Paste a normal YouTube URL or the 11-char ID.";
        return;
      }
      if (typeof YT === "undefined" || !YT.Player) {
        statusEl.textContent = "YouTube API not loaded yet. Wait 1–2 seconds and try again.";
        return;
      }
      resetCueState();
      createPlayer(vid);
    });

    startBtn.addEventListener("click", () => {
      if (!player) return;
      playing = true;
      player.playVideo();
      if (!tickHandle) tickHandle = setInterval(tick, 16);
    });

    pauseBtn.addEventListener("click", () => {
      if (!player) return;
      playing = false;
      player.pauseVideo();
    });

    resetBtn.addEventListener("click", () => {
      if (!player) return;
      playing = false;
      player.pauseVideo();
      player.seekTo(0, true);
      resetCueState();
      statusEl.textContent = `Reset to 0. Press Start. (JSON first event = ${FIRST_T_MS}ms)`;
    });
  </script>
</body>
</html>
